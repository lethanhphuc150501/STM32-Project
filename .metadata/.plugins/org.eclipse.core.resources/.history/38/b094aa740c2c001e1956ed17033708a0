/*
 * timer.c
 *
 *  Created on: Jul 25, 2023
 *      Author: Phuc Le
 */

#include "timer.h"

int timer0_counter = 0;
int timer0_flag = 0;
extern TIM_HandleTypeDef htim2;
uint32_t TIMER_CYCLE = 10;
uint32_t TIMER_CYCLE = 8000000 / (htim2.Init.Prescaler + 1) / (htim2.Init.Period + 1);

void setTimer0(int duration)
{
	timer0_counter = duration / TIMER_CYCLE;
	timer0_flag = 0;
}

void timer_run()
{
	if (timer0_counter > 0)
	{
		timer0_counter--;
		if (timer0_counter == 0) timer0_flag = 1;
	}
}

int get_timer0_flag()
{
	return timer0_flag;
}

void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)
{
	timer_run();
	if (htim->Instance == TIM2)
	{
		button_reading();
	}
}
